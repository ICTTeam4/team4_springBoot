<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace는 반드시 mapper 위치로 설정해야 된다. -->
<mapper namespace="com.saintkream.server.domain.members.mapper.MembersMapper">
<!-- 닉네임 중복확인 yb-->
	<select id="checkNickname" parameterType="String" resultType="int"> 
	SELECT COUNT(*) FROM member WHERE nickname = #{nickname} 
	</select>
<!--  이메일 중복 확인 yb -->
<select id="checkEmail" parameterType="String" resultType="int">
 SELECT IFNULL(COUNT(*), 0) FROM member WHERE email = #{email} 
 </select>
<!--  회원가입  yb-->
<insert id="insertMember" parameterType="MembersVO"> 
INSERT INTO member 
(name, email, tel_no, password, adv_agree, personal_agree, reg_date, status, nickname) 
VALUES (#{name}, #{email}, #{tel_no}, #{password}, #{adv_agree}, #{personal_agree}, NOW(), #{status}, #{nickname}) 
</insert>


	<select id="findUserByProvider" parameterType="MembersVO" resultType="MembersVO">
		select * from members 
		where  
		(
          (sns_provider = 'kakao' and sns_email_kakao = #{sns_email_kakao})
		OR
		  (sns_provider = 'naver' and sns_email_naver = #{sns_email_naver})
		)
	</select>

	<insert id="insertUser" parameterType="MembersVO">
		insert into members(
			m_id, 
			<if test="m_pw != null">
			m_pw, 
			</if>
			m_name, 
			<if test="m_age != null">
			m_age, 
			</if>
			<if test="sns_email_kakao != null">
			sns_email_kakao, 
			</if>
			<if test="sns_email_naver != null">
			sns_email_naver, 
			</if>
			sns_provider,
			m_reg
		)
		values(
			#{m_id},
			<if test="m_pw != null">
			#{m_pw},
			</if>
			#{m_name},
			<if test="m_age != null">
			#{m_age},
			</if>
			<if test="sns_email_kakao != null">
			#{sns_email_kakao}, 
			</if>
			<if test="sns_email_naver != null">
			#{sns_email_naver}, 
			</if>
			#{sns_provider},
			now())
	</insert>
</mapper>